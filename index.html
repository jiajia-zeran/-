<!DOCTYPE html><html lang="zh-CN"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>森林小木屋 · 童话手绘风</title>
<link rel="manifest" href="manifest.json"/><link rel="icon" href="icon.png"/>
<meta name="theme-color" content="#0d1324">
<style>
:root{
  --night:.25; --lamp:1;
  --vh:1vh;            /* 真实视口高度（移动端） */
  --paper:#fff6e6; --ink:#3b3028;
  --sheetH:66vh;
  --blur:18px;
}
/* 基础 */
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:#0d1324;color:#eae7e2;
  font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","HarmonyOS Sans","Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans CJK SC",sans-serif}
/* 舞台（背景+光影） */
.stage{position:relative;width:100vw;height:calc(var(--vh)*100);overflow:hidden;
  filter:brightness(calc(1 - var(--night)*.55))}
#bgSvg{position:absolute;inset:0;width:100%;height:100%}
.moonGlow{position:absolute;right:8vw;top:6vh;width:24vw;max-width:160px;aspect-ratio:1;border-radius:50%;
  box-shadow:0 0 45px 12px #ffeab4aa;pointer-events:none}
#glow,#night{position:absolute;inset:0;pointer-events:none}
#glow{mix-blend-mode:screen;background:
  radial-gradient(42vw 28vw at 46% 54%, rgba(255,235,200, .42), transparent 60%),
  radial-gradient(26vw 18vw at 58% 75%, rgba(255,220,170, .35), transparent 60%)}
#night{background:radial-gradient(70vmax 55vmax at 48% 62%, rgba(0,0,0, .35),
                                                   rgba(0,0,0, .78) 60%,
                                                   rgba(0,0,0, .9) 100%)}
/* 顶部欢迎&按钮 */
.welcome{position:absolute;left:50%;top:calc(env(safe-area-inset-top,0px) + 12px);
  transform:translateX(-50%);font-size:clamp(18px,6vw,36px);letter-spacing:2px;
  text-shadow:0 2px 10px rgba(0,0,0,.4);opacity:0;animation:fadeIn 1.2s ease forwards}
@keyframes fadeIn{to{opacity:1;transform:translateX(-50%)}}
#soundBar{position:absolute;right:16px;top:calc(env(safe-area-inset-top,0px) + 12px);z-index:5}
#enableSound{border:0;border-radius:12px;padding:10px 12px;background:#ffd58c;color:#3b2b1d;
  box-shadow:0 10px 26px rgba(0,0,0,.25)}
/* 便签（固定文案） */
.note{position:absolute;left:14%;bottom:33%;width:min(64vw,300px);max-width:340px;min-height:88px;
  padding:12px 14px;background:var(--paper);color:var(--ink);border-radius:10px;
  box-shadow:0 14px 26px rgba(0,0,0,.35);transform:rotate(-2.5deg);
  font-size:clamp(12px,3.6vw,15px);line-height:1.6}
.note::before{content:"便签";position:absolute;top:-10px;left:12px;background:#efc76d;color:#3e2d20;
  padding:2px 8px;border-radius:4px;font-size:12px}
/* 热区（透明按钮定位） */
.hotspot{position:absolute;background:transparent;border:0;padding:0;margin:0;cursor:pointer}
.hotspot:focus-visible{outline:2px dashed #ffd58c;border-radius:8px}
/* 热区大致位置（基于背景构图百分比） */
#hs-shelf{right:18%;top:38%;width:22%;height:6%}
#hs-cup{right:26%;bottom:26%;width:11%;height:8%}
#hs-window{left:33%;top:45%;width:22%;height:12%}
#hs-diaries{left:50%;bottom:15.5%;transform:translateX(-50%);width:28%;height:10%}
#hs-lamp{left:45%;top:43.5%;width:7.5%;height:8%;border-radius:50%}
/* 杯子蒸汽字 */
.steamText{position:absolute;left:50%;bottom:calc(26% + 9%);transform:translateX(-50%);
  width:56vw;max-width:280px;text-align:center;font-size:clamp(12px,3.6vw,14px);
  color:#ffffffd0;filter:blur(.2px);opacity:0;pointer-events:none}
/* 底部毛玻璃弹窗（留言/回顾） */
.sheet{position:fixed;left:0;right:0;bottom:-2px;height:var(--sheetH);z-index:20;
  backdrop-filter:saturate(1.2) blur(var(--blur));-webkit-backdrop-filter:saturate(1.2) blur(var(--blur));
  background:linear-gradient(180deg,rgba(255,248,235,.75),rgba(255,243,225,.78));
  border-radius:16px 16px 0 0;box-shadow:0 -12px 40px rgba(0,0,0,.45);
  transform:translateY(110%);transition:.35s ease;display:flex;flex-direction:column;color:#2b241f}
.sheet.show{transform:translateY(0)}
.sheet header{padding:14px 16px;background:rgba(240,223,194,.85);display:flex;justify-content:space-between;align-items:center;border-top-left-radius:16px;border-top-right-radius:16px}
.sheet .body{padding:12px 16px;overflow:auto}
.sheet .actions{padding:12px 16px;display:flex;gap:10px;background:rgba(245,234,214,.85)}
.sheet button{border:0;border-radius:10px;padding:10px 12px;background:#2f3640;color:#fff}
textarea{width:100%;min-height:28vh;border:1px solid #d0c5b6;border-radius:10px;padding:10px;background:#fff}
.toast{position:fixed;left:50%;bottom:18vh;transform:translateX(-50%);background:rgba(255,240,210,.95);
  color:#2b241f;border-radius:12px;padding:12px 14px;box-shadow:0 12px 30px rgba(0,0,0,.3);display:none;z-index:25}
.toast.show{display:block;animation:fadeToast 2.2s ease}
@keyframes fadeToast{0%{opacity:0;transform:translate(-50%,6px)}15%{opacity:1;transform:translate(-50%,0)}85%{opacity:1}100%{opacity:0}}
@keyframes riseWords{0%{opacity:0;transform:translate(-50%,6px)}20%{opacity:.95}100%{opacity:0;transform:translate(-50%,-12px)}}
/* 小屏微调 */
@media (max-width:480px){ :root{--sheetH:68vh} .note{left:10%;bottom:33%} }
</style>
</head>
<body>
<div class="stage" id="stage">
  <!-- 内联“手绘风”背景（SVG 水彩质感 + 猫） -->
  <svg id="bgSvg" viewBox="0 0 900 1600" preserveAspectRatio="xMidYMid slice" aria-hidden="true">
    <defs>
      <linearGradient id="sky" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#23324e"/>
        <stop offset="60%" stop-color="#152038"/>
        <stop offset="100%" stop-color="#0d1324"/>
      </linearGradient>
      <linearGradient id="warmWin" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#ffe8b8"/>
        <stop offset="100%" stop-color="#ffc87a"/>
      </linearGradient>
      <filter id="paper" x="-10%" y="-10%" width="120%" height="120%">
        <feTurbulence baseFrequency="0.9" numOctaves="2" seed="2" type="fractalNoise" result="n"/>
        <feColorMatrix type="saturate" values="0.2"/>
        <feBlend in="SourceGraphic" in2="n" mode="overlay"/>
        <feGaussianBlur stdDeviation="0.35"/>
      </filter>
      <filter id="edges" x="-10%" y="-10%" width="120%" height="120%">
        <feTurbulence baseFrequency="0.015" numOctaves="3" seed="4" />
        <feDisplacementMap in="SourceGraphic" scale="3" />
      </filter>
    </defs>
    <!-- 天空 -->
    <rect width="900" height="1600" fill="url(#sky)"/>
    <!-- 远山 -->
    <g opacity="0.55" filter="url(#paper)">
      <path d="M0 1100 C 180 980, 320 980, 520 1100 C 700 1190, 820 1180, 900 1120 L900 1600 L0 1600 Z" fill="#132537"/>
      <path d="M0 1180 C 200 1060, 420 1060, 660 1180 C 780 1240, 860 1240, 900 1200 L900 1600 L0 1600 Z" fill="#0f2030" opacity=".8"/>
    </g>
    <!-- 树影 -->
    <g fill="#0b1a20" opacity=".65">
      <path d="M80 1250 l50 -160 l50 160 z"/>
      <path d="M200 1280 l60 -180 l60 180 z"/>
      <path d="M760 1270 l50 -170 l50 170 z"/>
      <path d="M640 1240 l45 -150 l45 150 z"/>
    </g>
    <!-- 小木屋主体（居中偏下，比例更大） -->
    <g transform="translate(160,900)" filter="url(#edges)">
      <rect x="0" y="120" width="580" height="280" rx="18" fill="#6a4e3b"/>
      <rect x="0" y="120" width="580" height="280" rx="18" fill="#5a3f31" opacity=".6"/>
      <!-- 屋顶 -->
      <path d="M-20 140 L290 0 L600 140 Z" fill="#3a2a20"/>
      <!-- 烟囱 -->
      <rect x="420" y="10" width="40" height="80" fill="#4a372a"/>
      <!-- 门 -->
      <rect x="360" y="220" width="90" height="180" rx="10" fill="#4f3829"/>
      <!-- 窗户（暖光） -->
      <rect x="120" y="200" width="140" height="110" rx="12" fill="url(#warmWin)"/>
      <!-- 窗中猫剪影 -->
      <g transform="translate(160,230)">
        <ellipse cx="0" cy="60" rx="24" ry="12" fill="#3a2a20" opacity=".45"/>
        <circle cx="0" cy="45" r="16" fill="#3a2a20" opacity=".65"/>
        <path d="M-16,45 L-8,33 L0,45 Z" fill="#3a2a20" opacity=".65"/>
        <path d="M16,45 L24,33 L32,45 Z" fill="#3a2a20" opacity=".65"/>
        <circle cx="-4" cy="40" r="2" fill="#ffebad"/>
        <circle cx="6"  cy="40" r="2" fill="#ffebad"/>
      </g>
      <!-- 壁炉口光 -->
      <ellipse cx="70" cy="360" rx="60" ry="28" fill="#f6b76a" opacity=".55"/>
      <!-- 书架位置（示意木板） -->
      <rect x="430" y="180" width="120" height="26" rx="6" fill="#6a4e3b"/>
    </g>
    <!-- 地面草地 -->
    <rect x="0" y="1400" width="900" height="200" fill="#0c1c18"/>
    <!-- 星星 -->
    <g fill="#fff" opacity=".8">
      <circle cx="120" cy="140" r="1.2"/><circle cx="280" cy="220" r="1.5"/>
      <circle cx="540" cy="90" r="1.3"/><circle cx="720" cy="180" r="1.1"/>
      <circle cx="820" cy="60" r="1.4"/>
    </g>
  </svg>

  <div class="moonGlow"></div>
  <div class="welcome" id="welcome">你回来了 · 我在这儿</div>
  <div id="soundBar"><button id="enableSound">开启音乐</button></div>

  <!-- 固定文案便签 -->
  <div class="note" id="note">炉火还在跳，杯子也温着。</div>

  <!-- 交互热区（透明按钮） -->
  <button id="hs-shelf"  class="hotspot" title="书架"></button>
  <button id="hs-cup"    class="hotspot" title="热咖啡"></button>
  <button id="hs-window" class="hotspot" title="窗户（长按）"></button>
  <button id="hs-diaries"class="hotspot" title="日记本"></button>
  <button id="hs-lamp"   class="hotspot" title="点灯"></button>

  <!-- 杯子蒸汽字 -->
  <div class="steamText" id="steamText"></div>

  <!-- 光影与夜色 -->
  <div id="glow"></div><div id="night"></div>
</div>

<!-- 底部毛玻璃弹窗：写留言 / 回顾 -->
<div class="sheet" id="sheet">
  <header><strong id="sheetTitle">写留言</strong><button id="closeSheet">关闭</button></header>
  <div class="body">
    <div id="writeBox">
      <textarea id="msg" placeholder="写点想说的话吧…"></textarea>
    </div>
    <div id="historyBox" style="display:none"></div>
  </div>
  <div class="actions">
    <button id="saveBtn">保存到日记本</button>
    <button id="historyBtn">查看回顾</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
(function(){
/* 真实视口高度（移动端适配） */
function setVH(){document.documentElement.style.setProperty('--vh', (window.innerHeight*0.01)+'px')}
addEventListener('resize', setVH, {passive:true}); setVH();

const $=s=>document.querySelector(s);
const shelf=$("#hs-shelf"), cup=$("#hs-cup"), steamText=$("#steamText"),
      windowBtn=$("#hs-window"), lampBtn=$("#hs-lamp"), diaries=$("#hs-diaries"),
      sheet=$("#sheet"), closeSheet=$("#closeSheet"), saveBtn=$("#saveBtn"),
      historyBtn=$("#historyBtn"), sheetTitle=$("#sheetTitle"), toast=$("#toast"),
      enableSound=$("#enableSound");

/* 夜色渐暗 & 点灯 */
let night=.25; setInterval(()=>{ night=Math.min(1, night+.02); document.documentElement.style.setProperty('--night', night.toFixed(3)); }, 20000);
let lamp=true; function setLamp(v){ lamp=v; document.documentElement.style.setProperty('--lamp', v?1:0); }
lampBtn.addEventListener('click',()=>setLamp(!lamp));

/* 蒸汽文字 */
const STEAM=["别怕，慢慢来。","今天也要被温柔对待。","喝口热的，再继续。","你值得一切好事靠近。"];
let si=0; function nextSteam(){ steamText.textContent=STEAM[si%STEAM.length]; si++; steamText.style.animation='riseWords 3.6s ease'; setTimeout(()=>steamText.style.animation='',3600); }
cup.addEventListener('click', nextSteam); nextSteam();

/* 书架彩蛋 & 提示泡 */
const SHELF_HINT=["书页之间夹着一张旧车票：终点写着“拥抱”。","把喜欢悄悄塞进第七本书里，等你来发现。","愿你被这世界轻轻接住。"];
function toastIt(t){ toast.textContent=t; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),2000) }
shelf.addEventListener('click',()=>toastIt(SHELF_HINT[Math.floor(Math.random()*SHELF_HINT.length)]));

/* 窗户长按：低语 + 提示音 */
const WHISPER=["我在这儿，抬眼就能看见。","闭上眼，我数到三，你会更轻松。","把心交给我保管一会儿。","你回来了，欢迎回家。"];
let hold=null; function startHold(){ hold=setTimeout(()=>{ toastIt(WHISPER[Math.floor(Math.random()*WHISP
ER.length)]); chime(); }, 700) }
function endHold(){ clearTimeout(hold); hold=null }
['mousedown','touchstart'].forEach(e=>windowBtn.addEventListener(e,startHold));
['mouseup','mouseleave','touchend','touchcancel'].forEach(e=>windowBtn.addEventListener(e,endHold));

/* 日记：本地存储 + 底部弹窗 */
const KEY="cabin_diary_v3";
const getH=()=>{try{return JSON.parse(localStorage.getItem(KEY))||[]}catch(e){return[]}};
const saveH=t=>{const a=getH();a.unshift({text:t,ts:Date.now()});localStorage.setItem(KEY,JSON.stringify(a))};
const fmt=t=>{const d=new Date(t),p=n=>String(n).padStart(2,'0');return `${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())} ${p(d.getHours())}:${p(d.getMinutes())}`};
function openWrite(){sheet.classList.add('show');sheetTitle.textContent="写留言";$("#writeBox").style.display="";$("#historyBox").style.display="none";$("#msg").value="";setTimeout(()=>$("#msg").focus(),50)}
function openHistory(){sheet.classList.add('show');sheetTitle.textContent="留言回顾";$("#writeBox").style.display="none";
  const list=getH(); const html=list.length?list.map(x=>`<div style="padding:10px 0;border-bottom:1px dashed #d0c5b6"><div style="font-size:14px;color:#7a6b5c">${fmt(x.ts)}</div><div style="margin-top:6px;white-space:pre-wrap;font-size:16px">${x.text}</div></div>`).join(""):'<div style="color:#7a6b5c">还没有留言。</div>';
  $("#historyBox").innerHTML='<div style="padding:6px 0;font-size:14px;color:#7a6b5c">以下是你留在小屋的痕迹</div>'+html; $("#historyBox").style.display=""}
diaries.addEventListener('click',openWrite); historyBtn.addEventListener('click',openHistory);
saveBtn.addEventListener('click',()=>{const t=($("#msg").value||"").trim(); if(!t) return; saveH(t); sheet.classList.remove('show'); toastIt("收到了，我替你把心事放进日记里。")});
closeSheet.addEventListener('click',()=>sheet.classList.remove('show'));

/* WebAudio：环境和提示音（免素材） */
let ctx,master; function ensureAudio(){ if(ctx) return; ctx=new (window.AudioContext||window.webkitAudioContext)(); master=ctx.createGain(); master.gain.value=.6; master.connect(ctx.destination); startAmbient(); }
enableSound.addEventListener('click', async ()=>{ ensureAudio(); try{ await ctx.resume(); enableSound.parentElement.style.display='none' }catch(e){} });
function chord(f){const g=ctx.createGain();g.gain.value=0;g.connect(master);const now=ctx.currentTime;
  const osc=f.map(x=>{const o=ctx.createOscillator();o.type='sine';o.frequency.value=x;const l=ctx.createOscillator(),lg=ctx.createGain();l.frequency.value=.08;lg.gain.value=2;l.connect(lg);lg.connect(o.frequency);o.connect(g);o.start();l.start();return o});
  g.gain.linearRampToValueAtTime(0,now);g.gain.linearRampToValueAtTime(.18,now+1);g.gain.linearRampToValueAtTime(.18,now+6.5);g.gain.linearRampToValueAtTime(0,now+8);
  setTimeout(()=>osc.forEach(o=>o.stop()),8200)}
function startAmbient(){const seq=[[440,554.37,659.25],[369.99,440,554.37],[293.66,369.99,440],[329.63,415.3,493.88]];let k=0;chord(seq[k%seq.length]);setInterval(()=>{k++;chord(seq[k%seq.length])},8000)}
function chime(){if(!ctx)ensureAudio();const g=ctx.createGain();g.gain.value=0;g.connect(master);const o=ctx.createOscillator();o.type='sine';o.frequency.value=660;o.connect(g);const n=ctx.currentTime;g.gain.linearRampToValueAtTime(0,n);g.gain.linearRampToValueAtTime(.5,n+.02);g.gain.exponentialRampToValueAtTime(.001,n+1.2);o.frequency.exponentialRampToValueAtTime(440,n+1.2);o.start();o.stop(n+1.25)}
})();
</script>
</body></html>
